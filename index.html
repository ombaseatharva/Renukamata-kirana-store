<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∞‡•á‡§£‡•Å‡§ï‡§æ ‡§Æ‡§æ‡§§‡§æ ‡§ï‡§ø‡§∞‡§æ‡§£‡§æ ‡§∏‡•ç‡§ü‡•ã‡§Ö‡§∞</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .form-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out;
            padding: 0 1rem;
        }
        .form-container.active {
            max-height: 500px; /* Adjust as needed */
            padding: 1rem;
        }
        /* Style to indicate product cards are interactive */
        .product-card {
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            cursor: pointer;
        }
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Header Section -->
    <header class="bg-blue-600 text-white text-center py-6 shadow-md">
        <h1 class="text-4xl font-bold">‡§∞‡•á‡§£‡•Å‡§ï‡§æ ‡§Æ‡§æ‡§§‡§æ ‡§ï‡§ø‡§∞‡§æ‡§£‡§æ ‡§∏‡•ç‡§ü‡•ã‡§Ö‡§∞</h1>
        <p class="text-lg mt-1">‡§§‡•Å‡§Æ‡§ö‡•á ‡§µ‡§ø‡§∂‡•ç‡§µ‡§∏‡§®‡•Ä‡§Ø ‡§ï‡§ø‡§∞‡§æ‡§£‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®</p>
    </header>

    <!-- Main Content Area -->
    <main class="container mx-auto p-4 md:p-8">
        
        <!-- Search Bar -->
        <div class="mb-8">
            <input type="text" id="searchInput" placeholder="Search for an item... (e.g., gahu) üîç" class="w-full p-4 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
        </div>

        <!-- Main Layout: Items on Left, Cart on Right -->
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-8">
            
            <!-- Left Side: Item List -->
            <div class="md:col-span-2 lg:col-span-3 bg-white p-6 rounded-lg shadow-sm border">
                <h2 class="text-3xl font-semibold mb-6 border-b pb-3">‡§µ‡§∏‡•ç‡§§‡•Ç ‡§®‡§ø‡§µ‡§°‡§æ</h2>
                <div id="item-list-container" class="space-y-6">
                    <!-- JavaScript will generate the item list here -->
                </div>
                
                <!-- Add New Category Section -->
                <div class="mt-8 pt-6 border-t">
                    <button id="addNewCategoryBtn" class="w-full bg-indigo-500 text-white py-3 px-4 rounded-lg font-semibold text-lg hover:bg-indigo-600 transition shadow">[+] ‡§®‡§µ‡•Ä‡§® ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ú‡•ã‡§°‡§æ (Add New Category)</button>
                    <div id="newCategoryForm" class="hidden mt-4 p-4 border rounded-lg bg-gray-50 space-y-4">
                        <h3 class="text-xl font-semibold">‡§®‡§µ‡•Ä‡§® ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ</h3>
                        <div>
                            <input type="text" id="newCategoryNameInput" placeholder="‡§∂‡•ç‡§∞‡•á‡§£‡•Ä‡§ö‡•á ‡§®‡§æ‡§µ (Category Name)" class="w-full p-2 border rounded-md">
                        </div>
                        <div class="flex gap-4">
                            <button id="saveNewCategoryBtn" class="w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 transition">‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ú‡§§‡§® ‡§ï‡§∞‡§æ</button>
                            <button id="cancelNewCategoryBtn" type="button" class="w-full bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡§æ</button>
                        </div>
                    </div>
                </div>

                 <button id="addCustomItemBtn" class="w-full mt-4 bg-yellow-500 text-white py-3 px-4 rounded-lg font-semibold text-lg hover:bg-yellow-600 transition shadow">[+] ‡§Ø‡§æ‡§¶‡•Ä‡§§ ‡§®‡§∏‡§≤‡•á‡§≤‡•Ä ‡§µ‡§∏‡•ç‡§§‡•Ç ‡§ú‡•ã‡§°‡§æ</button>
                 <!-- Form for adding a custom item, hidden by default -->
                 <div id="customItemForm" class="hidden mt-4 p-4 border rounded-lg bg-gray-50 space-y-4">
                    <h3 class="text-xl font-semibold">‡§®‡§µ‡•Ä‡§® ‡§µ‡§∏‡•ç‡§§‡•Ç ‡§ü‡§æ‡§ï‡§æ</h3>
                    <div>
                        <input type="text" id="customItemName" placeholder="‡§µ‡§∏‡•ç‡§§‡•Ç‡§ö‡•á ‡§®‡§æ‡§µ" class="w-full p-2 border rounded-md">
                    </div>
                    <div>
                        <input type="number" id="customItemPrice" placeholder="‡§ï‡§ø‡§Ç‡§Æ‡§§ (‚Çπ)" class="w-full p-2 border rounded-md">
                    </div>
                    <div class="flex gap-4">
                        <button id="saveCustomItemBtn" class="w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600 transition">‡§Ø‡§æ‡§¶‡•Ä‡§§ ‡§ü‡§æ‡§ï‡§æ</button>
                        <button id="cancelCustomItemBtn" type="button" class="w-full bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡§æ</button>
                    </div>
                </div>
            </div>

            <!-- Right Side: Shopping Cart -->
            <div class="md:col-span-1 lg:col-span-2 bg-white p-6 rounded-lg shadow-sm border h-fit sticky top-8">
                <h2 class="text-3xl font-semibold mb-6 border-b pb-3">‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ñ‡§∞‡•á‡§¶‡•Ä‡§ö‡•Ä ‡§Ø‡§æ‡§¶‡•Ä</h2>
                <div id="cart-items" class="min-h-[100px] max-h-[50vh] overflow-y-auto pr-2">
                    <p class="text-gray-500 text-center py-8">‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§Ø‡§æ‡§¶‡•Ä ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á.</p>
                </div>
                <div class="mt-6 pt-4 border-t-2 border-dashed">
                    <h3 class="text-3xl font-bold text-right">‡§è‡§ï‡•Ç‡§£: <span id="total-price" class="text-green-600">‚Çπ 0.00</span></h3>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            try {
                // --- Default DATA: All store items in Marathi and English---
                const defaultProducts = [
                    { id: 1, name: '‡§ó‡§π‡•Ç', nameEn: 'gahu', category: '‡§ß‡§æ‡§®‡•ç‡§Ø ‡§Ü‡§£‡§ø ‡§™‡•Ä‡§†', prices: { '‡•®‡•´‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 11, '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 21, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 42 } },
                    { id: 2, name: '‡§§‡§æ‡§Ç‡§¶‡•Ç‡§≥ ‡§ï‡•ã‡§≤‡§Æ', nameEn: 'tandul kolam', category: '‡§ß‡§æ‡§®‡•ç‡§Ø ‡§Ü‡§£‡§ø ‡§™‡•Ä‡§†', prices: { '‡•®‡•´‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 11, '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 26, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 52 } },
                    { id: 3, name: '‡§§‡§æ‡§Ç‡§¶‡•Ç‡§≥ ‡§¨‡§æ‡§∏‡§Æ‡§§‡•Ä', nameEn: 'tandul basmati', category: '‡§ß‡§æ‡§®‡•ç‡§Ø ‡§Ü‡§£‡§ø ‡§™‡•Ä‡§†', prices: { '‡•®‡•´‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 13, '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 30, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 60 } },
                    { id: 4, name: '‡§™‡•ã‡§π‡•á', nameEn: 'pohe', category: '‡§ß‡§æ‡§®‡•ç‡§Ø ‡§Ü‡§£‡§ø ‡§™‡•Ä‡§†', prices: { '‡•®‡•´‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 15, '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 35, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 65 } },
                    { id: 5, name: '‡§∏‡§æ‡§¨‡•Å‡§¶‡§æ‡§£‡§æ', nameEn: 'sabudana', category: '‡§ß‡§æ‡§®‡•ç‡§Ø ‡§Ü‡§£‡§ø ‡§™‡•Ä‡§†', prices: { '‡•®‡•´‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 12, '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 24, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 45 } },
                    { id: 6, name: '‡§∞‡§µ‡§æ', nameEn: 'rava', category: '‡§ß‡§æ‡§®‡•ç‡§Ø ‡§Ü‡§£‡§ø ‡§™‡•Ä‡§†', prices: { '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 24, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 48 } },
                    { id: 7, name: '‡§Æ‡•à‡§¶‡§æ', nameEn: 'maida', category: '‡§ß‡§æ‡§®‡•ç‡§Ø ‡§Ü‡§£‡§ø ‡§™‡•Ä‡§†', prices: { '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 40, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 80 } },
                    { id: 8, name: '‡§§‡•Ç‡§∞‡§°‡§æ‡§≥', nameEn: 'tur dal', category: '‡§°‡§æ‡§≥‡•Ä ‡§Ü‡§£‡§ø ‡§ï‡§°‡§ß‡§æ‡§®‡•ç‡§Ø‡•á', prices: { '‡•®‡•´‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 25, '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 50, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 100 } },
                    { id: 9, name: '‡§â‡§°‡•Ä‡§¶ ‡§°‡§æ‡§≥', nameEn: 'udid dal', category: '‡§°‡§æ‡§≥‡•Ä ‡§Ü‡§£‡§ø ‡§ï‡§°‡§ß‡§æ‡§®‡•ç‡§Ø‡•á', prices: { '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 60, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 120 } },
                    { id: 10, name: '‡§∂‡•á‡§Ç‡§ó‡§¶‡§æ‡§£‡§æ', nameEn: 'shengdana', category: '‡§°‡§æ‡§≥‡•Ä ‡§Ü‡§£‡§ø ‡§ï‡§°‡§ß‡§æ‡§®‡•ç‡§Ø‡•á', prices: { '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 60, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 120 } },
                    { id: 11, name: '‡§Æ‡§ü‡§ï‡•Ä', nameEn: 'matki', category: '‡§°‡§æ‡§≥‡•Ä ‡§Ü‡§£‡§ø ‡§ï‡§°‡§ß‡§æ‡§®‡•ç‡§Ø‡•á', prices: { '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 90, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 180 } },
                    { id: 12, name: '‡§∏‡§æ‡§ñ‡§∞', nameEn: 'sakhar', category: '‡§∏‡§æ‡§ñ‡§∞, ‡§ó‡•Ç‡§≥ ‡§Ü‡§£‡§ø ‡§§‡•á‡§≤', prices: { '‡•´‡•¶‡•¶ ‡§ó‡•ç‡§∞‡•Ö': 60, '‡•ß ‡§ï‡§ø‡§≤‡•ã': 120 } },
                    { id: 13, name: '‡§ó‡•Ç‡§≥', nameEn: 'gul', category: '‡§∏‡§æ‡§ñ‡§∞, ‡§ó‡•Ç‡§≥ ‡§Ü‡§£‡§ø ‡§§‡•á‡§≤', prices: { '‡•ß ‡§®‡§ó': 15 } },
                    { id: 14, 'name': '‡§§‡•á‡§≤', nameEn: 'tel', category: '‡§∏‡§æ‡§ñ‡§∞, ‡§ó‡•Ç‡§≥ ‡§Ü‡§£‡§ø ‡§§‡•á‡§≤', prices: { '‡•ß ‡§°‡§¨‡§æ': 40 } },
                    { id: 15, name: '‡§Æ‡•Ö‡§ó‡•Ä', nameEn: 'maggi', category: '‡§™‡•Ö‡§ï ‡§ï‡•á‡§≤‡•á‡§≤‡•á ‡§™‡§¶‡§æ‡§∞‡•ç‡§•', prices: { '‡•ß ‡§®‡§ó': 7 } },
                    { id: 16, name: '‡§ï‡§ø‡§∏‡§æ‡§® ‡§ú‡•Ö‡§Æ', nameEn: 'kissan jam', category: '‡§™‡•Ö‡§ï ‡§ï‡•á‡§≤‡•á‡§≤‡•á ‡§™‡§¶‡§æ‡§∞‡•ç‡§•', prices: { '‡•ß ‡§®‡§ó': 25 } },
                    { id: 17, name: '‡§ó‡•ã‡§≥‡•Ä ‡§∏‡§æ‡§¨‡§£', nameEn: 'goli saban', category: '‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï ‡§ï‡§æ‡§≥‡§ú‡•Ä ‡§Ü‡§£‡§ø ‡§á‡§§‡§∞', prices: { '‡•ß ‡§®‡§ó': 15 } },
                    { id: 18, name: '‡§®‡•Ä‡§§‡§æ ‡§Æ‡•á‡§π‡§Ç‡§¶‡•Ä', nameEn: 'nita mehendi', category: '‡§µ‡•à‡§Ø‡§ï‡•ç‡§§‡§ø‡§ï ‡§ï‡§æ‡§≥‡§ú‡•Ä ‡§Ü‡§£‡§ø ‡§á‡§§‡§∞', prices: { '‡•ß ‡§®‡§ó': 10 } },
                ];

                let products = JSON.parse(localStorage.getItem('renukaKiranaProducts')) || defaultProducts;
                let categories = JSON.parse(localStorage.getItem('renukaKiranaCategories')) || [...new Set(products.map(p => p.category))];
                let cart = []; // Cart is now empty by default

                const itemListContainer = document.getElementById('item-list-container');
                const searchInput = document.getElementById('searchInput');
                const cartItemsContainer = document.getElementById('cart-items');
                const totalPriceEl = document.getElementById('total-price');
                const addCustomItemBtn = document.getElementById('addCustomItemBtn');
                const customItemForm = document.getElementById('customItemForm');
                const customItemNameInput = document.getElementById('customItemName');
                const customItemPriceInput = document.getElementById('customItemPrice');
                const saveCustomItemBtn = document.getElementById('saveCustomItemBtn');
                const cancelCustomItemBtn = document.getElementById('cancelCustomItemBtn');
                const addNewCategoryBtn = document.getElementById('addNewCategoryBtn');
                const newCategoryForm = document.getElementById('newCategoryForm');
                const newCategoryNameInput = document.getElementById('newCategoryNameInput');
                const saveNewCategoryBtn = document.getElementById('saveNewCategoryBtn');
                const cancelNewCategoryBtn = document.getElementById('cancelNewCategoryBtn');


                function saveProducts() {
                    localStorage.setItem('renukaKiranaProducts', JSON.stringify(products));
                }
                
                function saveCategories() {
                    localStorage.setItem('renukaKiranaCategories', JSON.stringify(categories));
                }

                function enterProductEditMode(productId) {
                    const product = products.find(p => p.id === productId);
                    if (!product) return;
                    const productCard = document.getElementById(`product-card-${productId}`);
                    if (!productCard) return;

                    if ('vibrate' in navigator) {
                        navigator.vibrate(50); // Haptic feedback on mobile
                    }
                    
                    productCard.innerHTML = `
                        <div class="space-y-2">
                            <input type="text" value="${product.name}" class="edit-product-name w-full p-2 border rounded-md font-bold">
                            <input type="text" value="${product.nameEn || ''}" placeholder="Romanized Name" class="edit-product-nameEn w-full p-2 border rounded-md">
                            <div class="edit-price-entries space-y-2 border-t pt-2 mt-2">
                                ${Object.keys(product.prices).map(q => `
                                    <div class="flex gap-2 items-center">
                                        <input type="text" value="${q}" class="edit-product-quantity w-1/2 p-2 border rounded-md text-sm">
                                        <input type="number" value="${product.prices[q]}" class="edit-product-price w-1/2 p-2 border rounded-md text-sm">
                                        <button class="remove-price-point-btn text-red-500">‚úñ</button>
                                    </div>`).join('')}
                            </div>
                            <button class="add-edit-price-point-btn text-sm text-blue-600 hover:underline">+ Add another price</button>
                            <div class="flex gap-2 pt-2">
                                <button class="save-edit-product-btn w-full bg-green-500 text-white py-1 px-2 text-sm rounded-md" data-product-id="${productId}">Save</button>
                                <button class="cancel-edit-product-btn w-full bg-gray-500 text-white py-1 px-2 text-sm rounded-md">Cancel</button>
                            </div>
                            <button class="delete-product-btn w-full bg-red-500 text-white mt-2 py-1 px-2 text-sm rounded-md" data-product-id="${productId}">Delete Product</button>
                        </div>`;
                }

                function renderProducts(productsToRender) {
                    itemListContainer.innerHTML = '';
                    const productsByCategory = {};
                    productsToRender.forEach(p => {
                        if (!productsByCategory[p.category]) productsByCategory[p.category] = [];
                        productsByCategory[p.category].push(p);
                    });

                    const isSearching = productsToRender.length !== products.length;

                    categories.forEach(category => {
                        const categoryProducts = productsByCategory[category] || [];

                        if (isSearching && categoryProducts.length === 0) {
                            return;
                        }

                        const categoryDiv = document.createElement('div');
                        const categoryId = category.replace(/\s+/g, '-');
                        
                        const categoryHeader = document.createElement('div');
                        categoryHeader.className = 'flex justify-between items-center mb-4';
                        categoryHeader.innerHTML = `
                            <h3 class="text-2xl font-semibold text-blue-700">${category}</h3>
                            <div class="flex items-center gap-2">
                                <button class="add-product-btn text-gray-500 hover:text-green-700 p-1 rounded-md" data-category-id="${categoryId}" data-category-name="${category}">‚ûï Add Product</button>
                                <button class="edit-category-btn text-gray-500 hover:text-blue-700 p-1 rounded-md" data-category="${category}">‚úèÔ∏è Edit</button>
                            </div>
                        `;
                        categoryDiv.appendChild(categoryHeader);
                        
                        const addProductFormContainer = document.createElement('div');
                        addProductFormContainer.id = `add-product-form-${categoryId}`;
                        addProductFormContainer.className = 'form-container border-t pt-4 mt-4';
                        categoryDiv.appendChild(addProductFormContainer);

                        const itemsGrid = document.createElement('div');
                        itemsGrid.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4';
                        categoryProducts.forEach(product => {
                            const productCard = document.createElement('div');
                            productCard.className = 'product-card bg-gray-100 p-4 rounded-lg border';
                            productCard.id = `product-card-${product.id}`;
                            productCard.innerHTML = `
                                <p class="text-xl font-bold mb-3">${product.name}</p>
                                <div class="flex flex-wrap gap-2">
                                    ${Object.keys(product.prices).map(quantity => `
                                        <button class="flex-grow bg-blue-100 text-blue-800 border border-blue-300 py-2 px-3 rounded-md hover:bg-blue-600 hover:text-white transition text-sm"
                                            data-product-id="${product.id}" data-quantity="${quantity}" data-price="${product.prices[quantity]}">
                                            ${quantity} (‚Çπ${product.prices[quantity]})
                                        </button>`).join('')}
                                </div>`;
                            
                            // Event listeners for editing

                            // For Desktop: Double click to edit
                            productCard.addEventListener('dblclick', (e) => {
                                // Don't trigger edit if a button inside the card is the target
                                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) return;
                                enterProductEditMode(product.id);
                            });

                            // For Mobile: Long press to edit
                            let pressTimer;
                            const startPress = (e) => {
                                // Don't trigger edit if a button inside the card is the target
                                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) return;
                                pressTimer = window.setTimeout(() => enterProductEditMode(product.id), 500);
                            };
                            const cancelPress = () => clearTimeout(pressTimer);
                            
                            productCard.addEventListener('touchstart', startPress, { passive: true });
                            productCard.addEventListener('touchend', cancelPress);
                            productCard.addEventListener('touchmove', cancelPress);

                            itemsGrid.appendChild(productCard);
                        });
                        categoryDiv.appendChild(itemsGrid);
                        itemListContainer.appendChild(categoryDiv);
                    });
                }

                function renderCart() {
                    cartItemsContainer.innerHTML = '';
                    if (cart.length === 0) {
                        cartItemsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§Ø‡§æ‡§¶‡•Ä ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á.</p>';
                        updateTotal(); return;
                    }
                    
                    cart.forEach((cartItem, index) => {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'flex items-center justify-between py-3 border-b';
                        itemDiv.innerHTML = `
                            <div class="flex-grow"><span class="font-semibold">${cartItem.name} <span class="text-gray-600 font-normal">(${cartItem.quantity})</span></span></div>
                            <div class="flex items-center gap-2">
                                <button class="decrease-qty w-7 h-7 bg-gray-200 rounded-full font-bold text-lg hover:bg-red-500 hover:text-white transition" data-index="${index}">-</button>
                                <span class="w-8 text-center font-semibold">${cartItem.count}</span>
                                <button class="increase-qty w-7 h-7 bg-gray-200 rounded-full font-bold text-lg hover:bg-green-500 hover:text-white transition" data-index="${index}">+</button>
                                <button class="remove-btn text-red-500 hover:text-red-700 ml-2" data-index="${index}">üóëÔ∏è</button>
                            </div>
                            <span class="font-bold text-right w-24">‚Çπ${(cartItem.price * cartItem.count).toFixed(2)}</span>`;
                        cartItemsContainer.appendChild(itemDiv);
                    });
                    updateTotal();
                }
                
                function updateTotal() {
                    const total = cart.reduce((sum, item) => sum + (item.price * item.count), 0);
                    totalPriceEl.textContent = `‚Çπ ${total.toFixed(2)}`;
                }
                
                function addToCart(productId, quantity, price) {
                    const existingItem = cart.find(item => item.id === productId && item.quantity === quantity);
                    if (existingItem) existingItem.count++;
                    else cart.push({ id: productId, name: products.find(p => p.id === productId).name, quantity, price, count: 1 });
                    renderCart();
                }
                
                searchInput.addEventListener('input', e => {
                    const searchTerm = e.target.value.toLowerCase();
                    renderProducts(products.filter(p => p.name.toLowerCase().includes(searchTerm) || (p.nameEn && p.nameEn.toLowerCase().includes(searchTerm))));
                });

                itemListContainer.addEventListener('click', e => {
                    const button = e.target.closest('button');
                    if (!button) return;

                    if (button.dataset.productId && !button.classList.contains('save-edit-product-btn') && !button.classList.contains('delete-product-btn')) {
                       const { productId, quantity, price } = button.dataset;
                       addToCart(parseInt(productId), quantity, parseFloat(price));
                    }
                    if (button.classList.contains('edit-category-btn')) {
                        const categoryName = button.dataset.category;
                        const header = button.parentElement.parentElement;
                        header.innerHTML = `
                            <input type="text" value="${categoryName}" class="text-2xl font-semibold text-blue-700 border rounded-md px-2 flex-grow">
                            <div class="flex gap-2">
                                <button class="save-category-btn bg-green-500 text-white px-3 py-1 rounded-md" data-old-category="${categoryName}">Save</button>
                                <button class="cancel-edit-category-btn bg-gray-500 text-white px-3 py-1 rounded-md">Cancel</button>
                            </div>
                        `;
                        header.querySelector('input').focus();
                    }
                    if (button.classList.contains('save-category-btn')) {
                        const oldCategoryName = button.dataset.oldCategory;
                        const newCategoryName = button.parentElement.parentElement.querySelector('input').value.trim();
                        if (newCategoryName && newCategoryName !== oldCategoryName) {
                            products.forEach(p => { if (p.category === oldCategoryName) p.category = newCategoryName; });
                            saveProducts();
                            const catIndex = categories.findIndex(c => c === oldCategoryName);
                            if(catIndex !== -1) categories[catIndex] = newCategoryName;
                            saveCategories();
                        }
                        renderProducts(products);
                    }
                    if (button.classList.contains('cancel-edit-category-btn')) renderProducts(products);
                    
                    if (button.classList.contains('add-product-btn')) {
                        const { categoryId, categoryName } = button.dataset;
                        const formContainer = document.getElementById(`add-product-form-${categoryId}`);
                        
                        if (formContainer.classList.contains('active')) {
                            formContainer.classList.remove('active');
                            formContainer.innerHTML = '';
                        } else {
                            document.querySelectorAll('.form-container.active').forEach(fc => {
                                fc.classList.remove('active');
                                fc.innerHTML = '';
                            });

                            formContainer.innerHTML = `
                                <div class="space-y-3 p-4 border rounded-lg bg-gray-50">
                                    <h4 class="text-lg font-semibold">Add New Product to "${categoryName}"</h4>
                                    <input type="text" placeholder="Product Name (Marathi)" class="new-product-name w-full p-2 border rounded-md">
                                    <input type="text" placeholder="Romanized Name (e.g., gahu)" class="new-product-nameEn w-full p-2 border rounded-md">
                                    <div class="price-entries space-y-2">
                                        <div class="flex gap-2 items-center">
                                            <input type="text" placeholder="Quantity (e.g., ‡•ß ‡§ï‡§ø‡§≤‡•ã)" class="new-product-quantity w-1/2 p-2 border rounded-md">
                                            <input type="number" placeholder="Price (‚Çπ)" class="new-product-price w-1/2 p-2 border rounded-md">
                                        </div>
                                    </div>
                                    <button class="add-price-point-btn text-sm text-blue-600 hover:underline">+ Add another price</button>
                                    <div class="flex gap-4 pt-2">
                                        <button class="save-new-product-btn w-full bg-green-500 text-white py-2 px-4 rounded-md hover:bg-green-600" data-category-name="${categoryName}">Save Product</button>
                                        <button class="cancel-new-product-btn w-full bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600">Cancel</button>
                                    </div>
                                </div>`;
                            formContainer.classList.add('active');
                        }
                    }
                    
                    if (button.classList.contains('add-price-point-btn')) {
                        const priceEntries = button.previousElementSibling;
                        const newPriceEntry = document.createElement('div');
                        newPriceEntry.className = 'flex gap-2 items-center';
                        newPriceEntry.innerHTML = `
                            <input type="text" placeholder="Quantity" class="new-product-quantity w-1/2 p-2 border rounded-md">
                            <input type="number" placeholder="Price (‚Çπ)" class="new-product-price w-1/2 p-2 border rounded-md">`;
                        priceEntries.appendChild(newPriceEntry);
                    }

                    if (button.classList.contains('cancel-new-product-btn') || button.classList.contains('cancel-edit-product-btn')) {
                        renderProducts(products);
                    }

                    if (button.classList.contains('save-new-product-btn')) {
                        const form = button.closest('div.p-4');
                        const categoryName = button.dataset.categoryName;
                        const name = form.querySelector('.new-product-name').value.trim();
                        const nameEn = form.querySelector('.new-product-nameEn').value.trim();
                        const prices = {};
                        const priceEntries = form.querySelectorAll('.price-entries > div');
                        let validPrices = true;

                        priceEntries.forEach(entry => {
                            const quantity = entry.querySelector('.new-product-quantity').value.trim();
                            const price = parseFloat(entry.querySelector('.new-product-price').value);
                            if (quantity && !isNaN(price) && price > 0) prices[quantity] = price;
                            else validPrices = false;
                        });

                        if (name && validPrices && Object.keys(prices).length > 0) {
                            products.push({ id: Date.now(), name, nameEn, category: categoryName, prices });
                            saveProducts();
                            renderProducts(products);
                        } else alert('Please enter a valid product name and at least one valid quantity/price.');
                    }
                    
                    if (button.classList.contains('add-edit-price-point-btn')) {
                        const priceEntries = button.previousElementSibling;
                        const newPriceEntry = document.createElement('div');
                        newPriceEntry.className = 'flex gap-2 items-center';
                        newPriceEntry.innerHTML = `
                            <input type="text" placeholder="Quantity" class="edit-product-quantity w-1/2 p-2 border rounded-md text-sm">
                            <input type="number" placeholder="Price (‚Çπ)" class="edit-product-price w-1/2 p-2 border rounded-md text-sm">
                            <button class="remove-price-point-btn text-red-500">‚úñ</button>`;
                        priceEntries.appendChild(newPriceEntry);
                    }
                    
                    if (button.classList.contains('remove-price-point-btn')) {
                        button.parentElement.remove();
                    }

                    if (button.classList.contains('save-edit-product-btn')) {
                        const productId = parseInt(button.dataset.productId);
                        const productIndex = products.findIndex(p => p.id === productId);
                        const card = button.closest('.product-card');
                        const newName = card.querySelector('.edit-product-name').value.trim();
                        const newNameEn = card.querySelector('.edit-product-nameEn').value.trim();
                        const newPrices = {};
                        let valid = true;
                        card.querySelectorAll('.edit-price-entries > div').forEach(entry => {
                            const q = entry.querySelector('.edit-product-quantity').value.trim();
                            const p = parseFloat(entry.querySelector('.edit-product-price').value);
                            if (q && !isNaN(p) && p > 0) newPrices[q] = p; else valid = false;
                        });

                        if (newName && valid && Object.keys(newPrices).length > 0) {
                            products[productIndex].name = newName;
                            products[productIndex].nameEn = newNameEn;
                            products[productIndex].prices = newPrices;
                            saveProducts();
                            renderProducts(products);
                        } else alert('Invalid name or price details.');
                    }
                    
                    if (button.classList.contains('delete-product-btn')) {
                        if (confirm('Are you sure you want to delete this product?')) {
                            const productId = parseInt(button.dataset.productId);
                            products = products.filter(p => p.id !== productId);
                            saveProducts();
                            renderProducts(products);
                        }
                    }

                });

                cartItemsContainer.addEventListener('click', e => {
                    const button = e.target.closest('button');
                    if (!button || !button.dataset.index) return;
                    const index = parseInt(button.dataset.index);
                    if (button.classList.contains('remove-btn')) cart.splice(index, 1);
                    else if (button.classList.contains('increase-qty')) cart[index].count++;
                    else if (button.classList.contains('decrease-qty')) {
                        if (cart[index].count > 1) cart[index].count--; else cart.splice(index, 1);
                    }
                    renderCart();
                });
                
                addCustomItemBtn.addEventListener('click', () => {
                    customItemForm.classList.remove('hidden');
                    addCustomItemBtn.classList.add('hidden');
                });

                cancelCustomItemBtn.addEventListener('click', () => {
                    customItemForm.classList.add('hidden');
                    addCustomItemBtn.classList.remove('hidden');
                    customItemNameInput.value = '';
                    customItemPriceInput.value = '';
                });

                saveCustomItemBtn.addEventListener('click', () => {
                    const name = customItemNameInput.value.trim();
                    const price = parseFloat(customItemPriceInput.value);
                    if (name && !isNaN(price) && price > 0) {
                        cart.push({ id: 'custom-' + Date.now(), name, quantity: 'custom', price, count: 1 });
                        renderCart();
                        customItemForm.classList.add('hidden');
                        addCustomItemBtn.classList.remove('hidden');
                        customItemNameInput.value = '';
                        customItemPriceInput.value = '';
                    } else { alert("‡§Ö‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§®‡§æ‡§µ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§ï‡§ø‡§Ç‡§Æ‡§§. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ."); }
                });

                addNewCategoryBtn.addEventListener('click', () => {
                    newCategoryForm.classList.remove('hidden');
                    addNewCategoryBtn.classList.add('hidden');
                });

                cancelNewCategoryBtn.addEventListener('click', () => {
                    newCategoryForm.classList.add('hidden');
                    addNewCategoryBtn.classList.remove('hidden');
                    newCategoryNameInput.value = '';
                });

                saveNewCategoryBtn.addEventListener('click', () => {
                    const newCategoryName = newCategoryNameInput.value.trim();
                    if (newCategoryName) {
                        if (!categories.includes(newCategoryName)) {
                            categories.push(newCategoryName);
                            saveCategories();
                            renderProducts(products);
                            newCategoryForm.classList.add('hidden');
                            addNewCategoryBtn.classList.remove('hidden');
                            newCategoryNameInput.value = '';
                        } else {
                            alert('Category with this name already exists.');
                        }
                    } else {
                        alert('Please enter a category name.');
                    }
                });

                renderProducts(products);
                renderCart();
            } catch (error) {
                document.querySelector('main').innerHTML = `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg" role="alert"><strong class="font-bold">Oops! Something went wrong.</strong><span class="block sm:inline">The application could not be loaded. Please try refreshing the page.</span><pre class="mt-2 text-xs">${error}</pre></div>`;
                console.error("Application failed to load:", error);
            }
        });
    </script>
</body>
</html>

